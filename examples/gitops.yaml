tools:
- name: go-webapp-repo
  plugin: github-repo-scaffolding-golang
  options:
    owner: [[ githubUsername ]]
    org: ""
    repo: [[ repoName ]]
    branch: [[ defaultBranch ]]
    image_repo: [[ dockerhubUsername ]]/[[ repoName ]]
- name: jira-github-default
  plugin: jira-github-integ
  dependsOn: [ "go-webapp-repo.github-repo-scaffolding-golang" ]
  options:
    owner: [[ githubUsername ]]
    repo: [[ repoName ]]
    jiraBaseUrl: https://[[ jiraID ]].atlassian.net
    jiraUserEmail: [[ jiraUserEmail ]]
    jiraProjectKey: [[ jiraProjectKey ]]
    branch: main
- name: golang-webapp-actions
  plugin: githubactions-golang
  dependsOn: [ "go-webapp-repo.github-repo-scaffolding-golang" ]
  options:
    owner: ${{go-webapp-repo.github-repo-scaffolding-golang.outputs.owner}}
    org: ""
    repo: ${{go-webapp-repo.github-repo-scaffolding-golang.outputs.repo}}
    language:
      name: go
      version: "1.17"
    branch: [[ defaultBranch ]]
    build:
      enable: True
      command: "go build ./..."
    test:
      enable: True
      command: "go test ./..."
      coverage:
        enable: True
        profile: "-race -covermode=atomic"
        output: "coverage.out"
    docker:
      enable: False
      repo: ${{go-webapp-repo.github-repo-scaffolding-golang.outputs.repo}}
- name: argocd-dev
  plugin: argocd
  options:
    create_namespace: true
    repo:
      name: argo
      url: https://argoproj.github.io/argo-helm
    chart:
      chart_name: argo/argo-cd
      release_name: argocd
      namespace: [[ argocdNameSpace ]]
      wait: true
      timeout: [[ argocdDeployTimeout ]]
      upgradeCRDs: true
- name: go-webapp-argocd-deploy
  plugin: argocdapp
  dependsOn: ["argocd.argocd-dev", "go-webapp-repo.github-repo-scaffolding-golang"]
  options:
    app:
      name: ${{go-webapp-repo.github-repo-scaffolding-golang.outputs.repo}}
      namespace: [[ argocdNameSpace ]]
    destination:
      server: https://kubernetes.default.svc
      namespace: default
    source:
      valuefile: values.yaml
      path: helm/${{go-webapp-repo.github-repo-scaffolding-golang.outputs.repo}}
      repoURL: ${{go-webapp-repo.github-repo-scaffolding-golang.outputs.repoURL}}
